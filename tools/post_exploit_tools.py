"""
Post-Exploitation Tools

This module contains integrations for post-exploitation and privilege escalation tools.

Tool Selection Rationale:
- LinPEAS: Linux Privilege Escalation Awesome Script. Comprehensive Linux privilege escalation checker.
- WinPEAS: Windows Privilege Escalation Awesome Script. Comprehensive Windows privilege escalation checker.
"""

import logging
from datetime import datetime
from typing import Dict, Any, Callable

from .tool_factory import RedTeamToolFactory

logger = logging.getLogger(__name__)


def register_post_exploit_tools(factory: RedTeamToolFactory) -> Dict[str, Callable]:
    """
    Register post-exploitation tools with the factory.
    
    Args:
        factory: RedTeamToolFactory instance
        
    Returns:
        Dictionary mapping tool names to functions
    """
    tools = {}
    
    def create_linpeas_scan():
        """
        Create linpeas_scan tool.
        
        Why LinPEAS: Comprehensive Linux privilege escalation checker.
        Automatically identifies common privilege escalation vectors.
        """
        def linpeas_scan(target: str) -> Dict[str, Any]:
            """Run LinPEAS privilege escalation scan."""
            logger.info(f"Running LinPEAS on: {target}")
            # Note: LinPEAS is typically run on the target system
            # This would require SSH access or similar
            return {
                "target": target,
                "tool": "linpeas",
                "note": "LinPEAS must be run on the target system",
                "timestamp": datetime.now().isoformat()
            }
        
        return linpeas_scan
    
    def create_winpeas_scan():
        """
        Create winpeas_scan tool.
        
        Why WinPEAS: Comprehensive Windows privilege escalation checker.
        Automatically identifies common Windows privilege escalation vectors.
        """
        def winpeas_scan(target: str) -> Dict[str, Any]:
            """Run WinPEAS privilege escalation scan."""
            logger.info(f"Running WinPEAS on: {target}")
            # Note: WinPEAS is typically run on the target system
            return {
                "target": target,
                "tool": "winpeas",
                "note": "WinPEAS must be run on the target system",
                "timestamp": datetime.now().isoformat()
            }
        
        return winpeas_scan
    
    # Register post-exploitation tools
    tools['linpeas_scan'] = create_linpeas_scan()
    tools['winpeas_scan'] = create_winpeas_scan()
    
    return tools


# Export tool names for this category
__all__ = [
    'register_post_exploit_tools',
    'linpeas_scan',
    'winpeas_scan',
]

