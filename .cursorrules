# Cursor Rules for Vibe Code Bench - Red Team Security Testing Agent

## Testing Requirements

- **ALWAYS ensure all tests pass before completing any task**
- Run tests after changes: `pytest mini/test_mini_agent.py -v`
- Add tests as you implement new features or modify existing code
- Use mocks for external dependencies (HTTP requests, LLM calls, file I/O)
- Test both success and failure paths

## Agent Activation Safety

### ⚠️ CRITICAL: Agent Execution Approval Required
- **NEVER run or activate the red team agent without explicit user approval**
- Before executing `mini_red_team_agent.py` or any agent script:
  1. Ask: "Should I run the agent against [target]? This will perform security testing."
  2. Wait for explicit confirmation before proceeding
  3. State what will happen (URL, tools, actions)
- Applies to: direct execution, test runs, any security testing scripts

## Code Quality

- Follow PEP 8, use type hints, add docstrings
- Handle exceptions gracefully, never expose sensitive info in errors
- Never hardcode API keys/secrets (use environment variables)
- Validate and sanitize all inputs
- Keep functions focused and single-purpose

## Environment Variables

- Required: `ANTHROPIC_API_KEY`, `LANGFUSE_SECRET_KEY`, `LANGFUSE_PUBLIC_KEY`
- Optional: `LANGFUSE_HOST` (defaults to cloud.langfuse.com)
- Always check for required vars and provide clear error messages

## LangChain & LangFuse

- Always initialize LangFuse for agent runs
- Flush LangFuse data before script termination
- Use claude-3-haiku for mini agent
- Include metadata in agent invocations

## Before Completing Tasks

- ✅ All tests pass 
- ✅ New code has tests
- ✅ User approval obtained before running agent
- ✅ Error handling in place
- ✅ No linting errors
